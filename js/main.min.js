var GUI={main:null,friction:null,thruster:null},Render={canvas:null,context:null,iterationDelay:1e3/30},Game={gravitationalAcceleration:.5,exhaustSpread:2,exhaustRandomness:.3,minExhaustVelocity:16,maxExhaustVelocity:20,thrusterAcceleration:1,thrusterParticles:4,shipBorderRebound:.35,shipBorderFriction:.8,shipDrag:.99,particleDrag:.9,particleType:"redFlame",nullifyThreshold:1,ships:[],playerID:0,loop:function(){forEach(Game.ships,function(e){e.x+=e.v.x,e.y+=e.v.y,e.y>window.innerHeight-e.height/2?(e.y=window.innerHeight-e.height/2,e.v.y=-e.v.y*Game.shipBorderRebound,e.v.x*=Game.shipBorderFriction,Game.nullifyLowVelocity(e)):e.y<e.height/2&&(e.y=e.height/2,e.v.y=-e.v.y*Game.shipBorderRebound,e.v.x*=Game.shipBorderFriction,Game.nullifyLowVelocity(e)),e.x>window.innerWidth-e.width/2?(e.x=window.innerWidth-e.width/2,e.v.x=-e.v.x*Game.shipBorderRebound,e.v.y*=Game.shipBorderFriction,Game.nullifyLowVelocity(e)):e.x<e.width/2&&(e.x=e.width/2,e.v.x=-e.v.x*Game.shipBorderRebound,e.v.y*=Game.shipBorderFriction,Game.nullifyLowVelocity(e)),forEach(e.particles,function(a){a.x+=a.v.x,a.y+=a.v.y,a.y>window.innerHeight-a.height/2?(a.y=window.innerHeight-a.height/2,a.v.y=-a.v.y):a.y<a.height/2&&(a.y=a.height/2,a.v.y=-a.v.y),a.x>window.innerWidth-a.width/2?(a.x=window.innerWidth-a.width/2,a.v.x=-a.v.x):a.x<a.width/2&&(a.x=a.width/2,a.v.x=-a.v.x),a.x-a.width/2<e.x+e.width/2&&a.x+a.width/2>e.x-e.width/2&&a.y-a.height/2<e.y+e.height/2&&a.y+a.height/2>e.y-e.height/2&&(a.v.x+=e.v.x,a.v.y+=e.v.y),a.v.x*=Game.particleDrag,a.v.y*=Game.particleDrag,a.v.x+=random.number(-Game.exhaustRandomness*a.v.x,Game.exhaustRandomness*a.v.x),a.v.y+=random.number(-Game.exhaustRandomness*a.v.y,Game.exhaustRandomness*a.v.y)}),e.v.y+=Game.gravitationalAcceleration,e.v.x*=Game.shipDrag,e.v.y*=Game.shipDrag}),(io.keysHeld[Jenjens.keys.w]||io.keysHeld[Jenjens.keys.up])&&(Game.ships[Game.playerID].v.y-=Game.thrusterAcceleration,Game.ships[Game.playerID].exhaust("down",Game.thrusterParticles)),(io.keysHeld[Jenjens.keys.a]||io.keysHeld[Jenjens.keys.left])&&(Game.ships[Game.playerID].v.x-=Game.thrusterAcceleration,Game.ships[Game.playerID].exhaust("right",Game.thrusterParticles)),(io.keysHeld[Jenjens.keys.s]||io.keysHeld[Jenjens.keys.down])&&(Game.ships[Game.playerID].v.y+=Game.thrusterAcceleration,Game.ships[Game.playerID].exhaust("up",Game.thrusterParticles)),(io.keysHeld[Jenjens.keys.d]||io.keysHeld[Jenjens.keys.right])&&(Game.ships[Game.playerID].v.x+=Game.thrusterAcceleration,Game.ships[Game.playerID].exhaust("left",Game.thrusterParticles)),Jenjens.render.clear(Render.context),forEach(Game.ships,function(e){forEach(e.particles,function(e){e.draw(Render.context),e.effect()})}),forEach(Game.ships,function(e){e.draw(Render.context)}),setTimeout(Game.loop,Render.iterationDelay)},nullifyLowVelocity:function(e){Math.abs(e.v.x)<Game.nullifyThreshold&&(e.v.x=0),Math.abs(e.v.y)<Game.nullifyThreshold&&(e.v.y=0)}};io.addEvent("keydown",io.keyDown),io.addEvent("keyup",io.keyUp),io.addEvent("load",function(){Render.canvas=document.getElementsByTagName("canvas")[0],Render.canvas.width=window.innerWidth,Render.canvas.height=window.innerHeight,Render.context=Render.canvas.getContext("2d"),GUI.main=new dat.GUI,GUI.main.add(Render,"iterationDelay",{Max:1,60:1e3/60,30:1e3/30,10:100,Min:1e3}).name("FPS"),GUI.main.add(Game,"gravitationalAcceleration",0,2).step(.1).name("g"),GUI.friction=GUI.main.addFolder("Friction"),GUI.friction.add(Game,"shipBorderRebound",.05,1).step(.05),GUI.friction.add(Game,"shipBorderFriction",.05,1).step(.05),GUI.friction.add(Game,"shipDrag",.9,1).step(.01),GUI.friction.add(Game,"particleDrag",.5,1).step(.05),GUI.friction.add(Game,"nullifyThreshold",.1,1).step(.1),GUI.thruster=GUI.main.addFolder("Thruster"),GUI.thruster.add(Game,"thrusterParticles",1,20).step(1),GUI.thruster.add(Game,"thrusterAcceleration",.05,4).step(.05),GUI.thruster.add(Game,"exhaustSpread",0,14).step(.2),GUI.thruster.add(Game,"exhaustRandomness",.05,.5).step(.05),GUI.thruster.add(Game,"minExhaustVelocity",10,20).step(2),GUI.thruster.add(Game,"maxExhaustVelocity",12,28).step(2),Game.ships.push(new Ship(window.innerWidth/2,window.innerHeight/2)),GUI.thruster.add(Game,"particleType",["standard","redFlame","cyanFlame","rainbow"]).onChange(function(){"standard"==Game.particleType?Game.ships[Game.playerID].particleType=Particle.effects.standard:"redFlame"==Game.particleType?Game.ships[Game.playerID].particleType=Particle.effects.redFlame:"cyanFlame"==Game.particleType?Game.ships[Game.playerID].particleType=Particle.effects.cyanFlame:"rainbow"==Game.particleType&&(Game.ships[Game.playerID].particleType=Particle.effects.rainbow)}),Game.loop()}),io.addEvent("resize",function(){Render.canvas.width=window.innerWidth,Render.canvas.height=window.innerHeight});