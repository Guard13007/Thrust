<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @namespace
 * @description Contains objects for a GUI to modify simulation on the fly.
 * @property {object} main - The main dat.GUI object. Contains folders for other values.
 * @property {object} friction - A dat.GUI folder for friction values.
 * @property {object} thruster - A dat.GUI folder for thruster simulation.
 */
var GUI={
	main:null,
	friction:null,
	thruster:null
};
/**
 * @namespace
 * @description Canvas/Context and how fast to render (also controls how fast physics/particles are simulated).
 * @property {object} canvas - The canvas element.
 * @property {object} context - The context object.
 * @property {number} iterationDelay - How long to wait between each iteration.
 */
var Render={
	canvas:null,
	context:null,
	iterationDelay:33
};
/**
 * @namespace
 * @description Main simulation values, where the Ships are stored, and the main loop.
 * @see {@linkcode Ship} and {@linkcode Particle}
 * @property {number} gravitationalAcceleration - How much velocity to apply each iteration.
 *
 * @property {number} exhaustSpread - Modifies how much random spread there is on exhaust.
 * @property {number} exhaustRandomness - Modifies how much particles move randomly each iteration.
 * @property {number} minExhaustVelocity - Minimum exhaust velocity added to Ship velocity.
 * @property {number} maxExhaustVelocity - Maximum exhaust velocity added to Ship velocity.
 * @property {number} thrusterAcceleration - How much the Ship accelerates from thrusting.
 * @property {number} thrusterParticles - How many Particles to spawn each iteration while thrusting.
 *
 * @property {number} shipBorderRebound - Multiplied to Ships' velocity when bouncing off borders.
 * @property {number} shipBorderFriction - Multiplied to Ships' velocity when dragging along a border.
 * @property {number} shipDrag - Multiplied to Ships' velocity each iteration to simulate the drag of an atmosphere.

 * @property {number} particleDrag - Artificial higher drag applied to Particles.

 * @property {Array} ships - Where all Ships in the simulation are stored.
 * @property {number} playerID - The index of which Ship in Game.ships is being controlled.
 */
var Game={
	gravitationalAcceleration:0.5,

	exhaustSpread:2,
	exhaustRandomness:0.3,
	minExhaustVelocity:16,
	maxExhaustVelocity:20,
	thrusterAcceleration:1,
	thrusterParticles:4,

	shipBorderRebound:0.35,
	shipBorderFriction:0.8,
	shipDrag:0.99,

	particleDrag:0.9,

	ships:[],
	playerID:0,

	/**
	 * @description Main game loop.
	 */
	loop:function(){
		forEach(Game.ships,function(b){
			//apply Ship velocity
			b.x+=b.v.x;
			b.y+=b.v.y;
			//Ship to border collisions
			if (b.y > window.innerHeight-b.height/2) {
				b.y = window.innerHeight-b.height/2;
				b.v.y=-b.v.y*Game.shipBorderRebound;
				b.v.x*=Game.shipBorderFriction;
			} else if (b.y &lt; b.height/2) {
				b.y = b.height/2;
				b.v.y=-b.v.y*Game.shipBorderRebound;
				b.v.x*=Game.shipBorderFriction;
			}
			if (b.x > window.innerWidth-b.width/2) {
				b.x = window.innerWidth-b.width/2;
				b.v.x=-b.v.x*Game.shipBorderRebound;
				b.v.y*=Game.shipBorderFriction;
			} else if (b.x &lt; b.width/2) {
				b.x = b.width/2;
				b.v.x=-b.v.x*Game.shipBorderRebound;
				b.v.y*=Game.shipBorderFriction;
			}
			forEach(b.particles,function(a){
				//apply Particle velocity
				a.x+=a.v.x;
				a.y+=a.v.y;
				//Particle to border collision
				if (a.y > window.innerHeight-a.height/2) {
					a.y = window.innerHeight-a.height/2;
					a.v.y=-a.v.y;
				} else if (a.y &lt; a.height/2) {
					a.y = a.height/2;
					a.v.y=-a.v.y;
				}
				if (a.x > window.innerWidth-a.width/2) {
					a.x = window.innerWidth-a.width/2;
					a.v.x=-a.v.x;
				} else if (a.x &lt; a.width/2) {
					a.x = a.width/2;
					a.v.x=-a.v.x;
				}
				//Particle to Ship collision
				if (a.x-a.width/2  &lt; b.x+b.width/2  &amp;&amp;
					a.x+a.width/2  > b.x-b.width/2  &amp;&amp;
					a.y-a.height/2 &lt; b.y+b.height/2 &amp;&amp;
					a.y+a.height/2 > b.y-b.height/2
				) {
					a.v.x+=b.v.x;
					a.v.y+=b.v.y;
					/*if(b.v.x>0 &amp;&amp; ship.v.x>0 || b.v.x&lt;0 &amp;&amp; ship.v.x&lt;0){
						b.v.x+=ship.v.x;
					}else{
						b.v.x-=ship.v.x;
					}
					if(b.v.y>0 &amp;&amp; ship.v.y>0 || b.v.y&lt;0 &amp;&amp; ship.v.y&lt;0){
						b.v.y+=ship.v.y;
					}else{
						b.v.y-=ship.v.y;
					}*/
				}
				//update Particle velocity
				a.v.x*=Game.particleDrag;
				a.v.y*=Game.particleDrag;
				a.v.x+=random.number(-Game.exhaustRandomness*a.v.x,Game.exhaustRandomness*a.v.x);
				a.v.y+=random.number(-Game.exhaustRandomness*a.v.y,Game.exhaustRandomness*a.v.y);
			});
			//update Ship velocity (gravity / drag)
			b.v.y+=Game.gravitationalAcceleration;
			b.v.x*=Game.shipDrag;
			b.v.y*=Game.shipDrag;
		});
		//apply Ship thrust
		if (io.keysHeld[Jenjens.keys.w] || io.keysHeld[Jenjens.keys.up]) {
			Game.ships[Game.playerID].v.y-=Game.thrusterAcceleration;
			Game.ships[Game.playerID].exhaust('down',Game.thrusterParticles);
		}
		if (io.keysHeld[Jenjens.keys.a] || io.keysHeld[Jenjens.keys.left]) {
			Game.ships[Game.playerID].v.x-=Game.thrusterAcceleration;
			Game.ships[Game.playerID].exhaust('right',Game.thrusterParticles);
		}
		if (io.keysHeld[Jenjens.keys.s] || io.keysHeld[Jenjens.keys.down]) {
			Game.ships[Game.playerID].v.y+=Game.thrusterAcceleration;
			Game.ships[Game.playerID].exhaust('up',Game.thrusterParticles);
		}
		if (io.keysHeld[Jenjens.keys.d] || io.keysHeld[Jenjens.keys.right]) {
			Game.ships[Game.playerID].v.x+=Game.thrusterAcceleration;
			Game.ships[Game.playerID].exhaust('left',Game.thrusterParticles);
		}
		//clear canvas
		Jenjens.render.clear(Render.context);
		//draw and update Particles
		forEach(Game.ships,function(b){
			forEach(b.particles,function(a){
				a.draw(Render.context);
				a.effect();
			});
		});
		//draw Ships
		forEach(Game.ships,function(b){
			b.draw(Render.context);
		});

		setTimeout(Game.loop,Render.iterationDelay);
	}
};

/** @description Adds keydown checking for thruster. */
io.addEvent('keydown',io.keyDown);
io.addEvent('keyup',io.keyUp);
io.addEvent('load',function(){
	//set up canvas
	Render.canvas=document.getElementsByTagName('canvas')[0];
	Render.canvas.width=window.innerWidth;
	Render.canvas.height=window.innerHeight;
	Render.context=Render.canvas.getContext('2d');

	//set up GUI
	GUI.main=new dat.GUI();
	GUI.main.add(Render,'iterationDelay',{Max:1,'60':17,'30':33,'10':100,Min:2000}).name("FPS");

	GUI.main.add(Game,'gravitationalAcceleration',0,2).step(0.1).name("g");
	GUI.friction=GUI.main.addFolder("Friction");
	GUI.friction.add(Game,'shipBorderRebound',0.05,1).step(0.05);
	GUI.friction.add(Game,'shipBorderFriction',0.05,1).step(0.05);
	GUI.friction.add(Game,'shipDrag',0.9,1).step(0.01);
	GUI.friction.add(Game,'particleDrag',0.5,1).step(0.05);
	GUI.thruster=GUI.main.addFolder("Thruster");
	GUI.thruster.add(Game,'thrusterParticles',1,20).step(1);
	GUI.thruster.add(Game,'thrusterAcceleration',0.05,4).step(0.05);
	GUI.thruster.add(Game,'exhaustSpread',0,14).step(0.2);
	GUI.thruster.add(Game,'exhaustRandomness',0.05,0.5).step(0.05);
	GUI.thruster.add(Game,'minExhaustVelocity',10,20).step(2);
	GUI.thruster.add(Game,'maxExhaustVelocity',12,28).step(2);

	//create Ship
	Game.ships.push(new Ship(window.innerWidth/2,window.innerHeight/2));

	//add Ship data to GUI
	/*GUI.thruster.add(Game.ships[Game.playerID],'particleType',{
		standard:Particle.effects.standard,
		redFlame:Particle.effects.redFlame,
		cyanFlame:Particle.effects.cyanFlame
	});*/

	//start main loop
	Game.loop();
});
io.addEvent('resize',function(){
	Render.canvas.width=window.innerWidth;
	Render.canvas.height=window.innerHeight;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Particle.html">Particle</a></li><li><a href="Ship.html">Ship</a></li></ul><h3>Namespaces</h3><ul><li><a href="Game.html">Game</a></li><li><a href="GUI.html">GUI</a></li><li><a href="Render.html">Render</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Sat Sep 13 2014 13:06:59 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
